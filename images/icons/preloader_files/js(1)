(function(e){var t=false;if(typeof define==="function"&&define.amd){define(e);t=true}if(typeof exports==="object"){module.exports=e();t=true}if(!t){var n=window.Cookies;var r=window.Cookies=e();r.noConflict=function(){window.Cookies=n;return r}}})(function(){function e(){var e=0;var t={};for(;e<arguments.length;e++){var n=arguments[e];for(var r in n){t[r]=n[r]}}return t}function t(n){function r(t,i,a){var s;if(typeof document==="undefined"){return}if(arguments.length>1){a=e({path:"/"},r.defaults,a);if(typeof a.expires==="number"){var o=new Date;o.setMilliseconds(o.getMilliseconds()+a.expires*864e5);a.expires=o}a.expires=a.expires?a.expires.toUTCString():"";try{s=JSON.stringify(i);if(/^[\{\[]/.test(s)){i=s}}catch(e){}if(!n.write){i=encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)}else{i=n.write(i,t)}t=encodeURIComponent(String(t));t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);t=t.replace(/[\(\)]/g,escape);var p="";for(var u in a){if(!a[u]){continue}p+="; "+u;if(a[u]===true){continue}p+="="+a[u]}return document.cookie=t+"="+i+p}if(!t){s={}}var c=document.cookie?document.cookie.split("; "):[];var d=/(%[0-9A-Z]{2})+/g;var l=0;for(;l<c.length;l++){var f=c[l].split("=");var g=f.slice(1).join("=");if(g.charAt(0)==='"'){g=g.slice(1,-1)}try{var m=f[0].replace(d,decodeURIComponent);g=n.read?n.read(g,m):n(g,m)||g.replace(d,decodeURIComponent);if(this.json){try{g=JSON.parse(g)}catch(e){}}if(t===m){s=g;break}if(!t){s[m]=g}}catch(e){}}return s}r.set=r;r.get=function(e){return r.call(r,e)};r.getJSON=function(){return r.apply({json:true},[].slice.call(arguments))};r.defaults={};r.remove=function(t,n){r(t,"",e(n,{expires:-1}))};r.withConverter=t;return r}return t(function(){})});!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ES6Promise=t()}(this,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}function n(e){V=e}function r(e){W=e}function i(){return function(){return process.nextTick(u)}}function a(){return"undefined"!=typeof U?function(){U(u)}:p()}function s(){var e=0,t=new $(u),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function o(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}function p(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<K;e+=2){var t=Q[e],n=Q[e+1];t(n),Q[e]=void 0,Q[e+1]=void 0}K=0}function c(){try{var e=require,t=e("vertx");return U=t.runOnLoop||t.runOnContext,a()}catch(e){return p()}}function d(e,t){var n=arguments,r=this,i=new this.constructor(f);void 0===i[te]&&C(i);var a=r._state;return a?!function(){var e=n[a-1];W(function(){return M(a,i,e,r._result)})}():S(r,i,e,t),i}function l(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(f);return A(n,e),n}function f(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function y(e){try{return e.then}catch(e){return ae.error=e,ae}}function _(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function v(e,t,n){W(function(e){var r=!1,i=_(n,t,function(n){r||(r=!0,t!==n?A(e,n):O(e,n))},function(t){r||(r=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,E(e,i))},e)}function h(e,t){t._state===re?O(e,t._result):t._state===ie?E(e,t._result):S(t,void 0,function(t){return A(e,t)},function(t){return E(e,t)})}function P(e,n,r){n.constructor===e.constructor&&r===d&&n.constructor.resolve===l?h(e,n):r===ae?(E(e,ae.error),ae.error=null):void 0===r?O(e,n):t(r)?v(e,n,r):O(e,n)}function A(t,n){t===n?E(t,g()):e(n)?P(t,n,y(n)):O(t,n)}function w(e){e._onerror&&e._onerror(e._result),T(e)}function O(e,t){e._state===ne&&(e._result=t,e._state=re,0!==e._subscribers.length&&W(T,e))}function E(e,t){e._state===ne&&(e._state=ie,e._result=t,W(w,e))}function S(e,t,n,r){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+re]=n,i[a+ie]=r,0===a&&e._state&&W(T,e)}function T(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,a=e._result,s=0;s<t.length;s+=3)r=t[s],i=t[s+n],r?M(n,r,i,a):i(a);e._subscribers.length=0}}function b(){this.error=null}function N(e,t){try{return e(t)}catch(e){return se.error=e,se}}function M(e,n,r,i){var a=t(r),s=void 0,o=void 0,p=void 0,u=void 0;if(a){if(s=N(r,i),s===se?(u=!0,o=s.error,s.error=null):p=!0,n===s)return void E(n,m())}else s=i,p=!0;n._state!==ne||(a&&p?A(n,s):u?E(n,o):e===re?O(n,s):e===ie&&E(n,s))}function I(e,t){try{t(function(t){A(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}function k(){return oe++}function C(e){e[te]=oe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function D(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[te]||C(this.promise),H(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&O(this.promise,this._result))):E(this.promise,R())}function R(){return new Error("Array Methods must be provided an Array")}function q(e){return new D(this,e).promise}function J(e){var t=this;return new t(H(e)?function(n,r){for(var i=e.length,a=0;a<i;a++)t.resolve(e[a]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function x(e){var t=this,n=new t(f);return E(n,e),n}function L(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Y(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(e){this[te]=k(),this._result=this._state=void 0,this._subscribers=[],f!==e&&("function"!=typeof e&&L(),this instanceof j?I(this,e):Y())}function F(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=j}var G=void 0;G=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var H=G,K=0,U=void 0,V=void 0,W=function(e,t){Q[K]=e,Q[K+1]=t,K+=2,2===K&&(V?V(u):ee())},X="undefined"!=typeof window?window:void 0,B=X||{},$=B.MutationObserver||B.WebKitMutationObserver,z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3),ee=void 0;ee=z?i():$?s():Z?o():void 0===X&&"function"==typeof require?c():p();var te=Math.random().toString(36).substring(16),ne=void 0,re=1,ie=2,ae=new b,se=new b,oe=0;return D.prototype._enumerate=function(e){for(var t=0;this._state===ne&&t<e.length;t++)this._eachEntry(e[t],t)},D.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===l){var i=y(e);if(i===d&&e._state!==ne)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===j){var a=new n(f);P(a,e,i),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},D.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===ne&&(this._remaining--,e===ie?E(r,n):this._result[t]=n),0===this._remaining&&O(r,this._result)},D.prototype._willSettleAt=function(e,t){var n=this;S(e,void 0,function(e){return n._settledAt(re,t,e)},function(e){return n._settledAt(ie,t,e)})},j.all=q,j.race=J,j.resolve=l,j.reject=x,j._setScheduler=n,j._setAsap=r,j._asap=W,j.prototype={constructor:j,then:d,catch:function(e){return this.then(null,e)}},j.polyfill=F,j.Promise=j,j});var Promise=window.Promise||ES6Promise.Promise;var init=JSON.parse(decodeURIComponent(window.location.search.substring(1)));var is_production=init.serverType==="production";var session;var saved_payment_request;var androidPayTapPayMerchantID;var androidPayPublickKey;var pay_with_google_options;var TAPPAY_FIELD_TYPES={CARD_NUMBER:"card-number",EXPIRATION_DATE:"expiration-date",CCV:"ccv"};var CARD_VIEW_NAME="card_view";var METHOD_NAME={CARD:"card",ANDROID_PAY:"android_pay",PAY_WITH_GOOGLE:"pay_with_google",APPLE_PAY:"apple_pay"};var CARD_TYPE={VISA:1,MASTERCARD:2,JCB:3,UNIONPAY:4,AMEX:5};var CARD_FUNDING={CREDIT:0,DEBIT:1,PREPAID:2};var LOGTYPE={FUNCTION:"function",API:"api",EXCEPTION:"exception"};var validate=function(){var e={amex:/^3[47]\d{0,13}/,mastercard:/(^(5[1-5]|2[3-6])\d{0,14})|^(((222[1-9])|(2720))\d{0,12})|^(((22[3-9])|(27[0-1]))\d{0,13})/,jcb:/^(?:2131|1800|35\d{0,2})\d{0,12}/,visa:/^4\d{0,15}/};var t={amex:"AMEX",mastercard:"MASTERCARD",jcb:"JCB",visa:"VISA"};return{cardNumber:function(e,t){e=(e+"").replace(/\s+|-/g,"");if(typeof t!=="undefined"){if(t==="AMEX"){return/^\d{15}$/.test(e)&&this.luhnCheck(e)}else{return/^\d{16}$/.test(e)&&this.luhnCheck(e)}}return/^\d{15,16}$/.test(e)&&this.luhnCheck(e)},ccv:function(e,t){if(typeof t!=="undefined"){if(t==="AMEX"){return/^\d{4}$/.test(e)}else{return/^\d{3}$/.test(e)}}return/^\d{3,4}$/.test(e)},expiry:function(e,t){var n,r,i=e;i+="",t+="";return!!/^\d+$/.test(i)&&(!!/^\d+$/.test(t)&&(1<=i&&i<=12&&(2===t.length&&(t=t<70?"20"+t:"19"+t),4===t.length&&(r=new Date(t,i),n=new Date,r.setMonth(r.getMonth()-1),r.setMonth(r.getMonth()+1,1),r>n))))},luhnCheck:function(e){var t,n,r,i,a,s;for(r=!0,i=0,n=(e+"").split("").reverse(),a=0,s=n.length;a<s;a++)t=n[a],t=parseInt(t,10),(r=!r)&&(t*=2),t>9&&(t-=9),i+=t;return i%10===0},cardType:function(n){for(var r in e){if(e[r].test(n)===true){return t[r]}}return"Unknown"}}}();window.addEventListener("message",handleEvent,false);var tpAPI={};tpAPI.getPrime=is_production?"/tpdirect/production/getprime":"/tpdirect/sandbox/getprime";tpAPI.getAndroidPayPrime=is_production?"/android-pay/production/getprime":"/android-pay/sandbox/getprime";tpAPI.getPayWithGooglePrime=is_production?"/google-pay/production/get-prime":"/google-pay/sandbox/get-prime";tpAPI.getApplePaySession="/apple-pay/get-session";tpAPI.getApplePayPrime=is_production?"/apple-pay/production/getprime":"/apple-pay/sandbox/getprime";tpAPI.getLinePayPrime=is_production?"/line-pay/production/get-prime":"/line-pay/sandbox/get-prime";tpAPI.log="/log";window.parent.postMessage(JSON.stringify({event:"iframe_get_prime_ready"}),init.origin);function handleEvent(e){if(e.origin!==init.origin){return}var t=JSON.parse(e.data);if(t.event==="get_prime"){var n=t.card.number;var r=t.card.exp_month;var i=t.card.exp_year;var a=t.card.ccv;var s=false;createToken(n,r,i,a,s,function(t){e.source.postMessage(JSON.stringify({event:"get_prime_done",result:t}),init.origin)})}if(t.event==="get_prime_for_tappay_fields"){var o;var n;var r;var i;var a;var s=true;var p=window.parent.frames;for(var u=0;u<p.length;u++){var c=p[u];try{var d=c.name;if(!n&&d===TAPPAY_FIELD_TYPES.CARD_NUMBER){n=c.getInputRawValue()}else if(!o&&d===TAPPAY_FIELD_TYPES.EXPIRATION_DATE){o=c.getInputRawValue().match(/(\d{2})(\d{2})/)||[undefined,undefined,undefined];r=o[1];i=o[2]}else if(!a&&d===TAPPAY_FIELD_TYPES.CCV){a=c.getInputRawValue()}}catch(e){}}createToken(n,r,i,a,s,function(t){e.source.postMessage(JSON.stringify({event:"get_prime_for_tappay_fields_done",result:t}),init.origin)})}if(t.event==="get_prime_for_card_view"){var l;var s=true;var p=window.parent.frames;for(var u=0;u<p.length;u++){var c=p[u];try{if(!l&&c.name===CARD_VIEW_NAME){l=c.getCard()}}catch(e){}}if(!l){e.source.postMessage(JSON.stringify({event:"get_prime_for_card_view_done",result:{status:-5,msg:"[TapPay] TapPay Card View are not ready, please listen to update with TPDirect.card.onUpdate"}}),init.origin)}createToken(l.number,l.exp_month,l.exp_year,l.ccv,s,function(t){e.source.postMessage(JSON.stringify({event:"get_prime_for_card_view_done",result:t}),init.origin)})}if(t.event==="line_pay_get_prime"){var f=tpAPI.getLinePayPrime;linePayGetPrime(f,t.fraud_id).then(function(t){e.source.postMessage(JSON.stringify({event:"line_pay_get_prime_done",url:f,result:t,err:null}),init.origin)}).catch(function(t){e.source.postMessage(JSON.stringify({event:"line_pay_get_prime_done",url:f,result:null,err:t}),init.origin)})}if(t.event==="apple_pay_get_prime"){var g=t.parameter;getApplePayPrime(g).then(function(t){e.source.postMessage(JSON.stringify({event:"apple_pay_get_prime_done",result:t,err:null}),init.origin)}).catch(function(t){e.source.postMessage(JSON.stringify({event:"apple_pay_get_prime_done",result:null,err:t}),init.origin)})}if(t.event==="apple_pay_get_session"){var m=t.paramsString;getApplePaySession(m).then(function(t){e.source.postMessage(JSON.stringify({event:"apple_pay_get_session_done",result:t,err:null}),init.origin)}).catch(function(t){e.source.postMessage(JSON.stringify({event:"apple_pay_get_session_done",result:null,err:t}),init.origin)})}if(t.event==="payment_request_apple_pay_get_prime"){var g=t.parameter;getApplePayPrime(g).then(function(t){e.source.postMessage(JSON.stringify({event:"payment_request_apple_pay_get_prime_done",result:t,err:null}),init.origin)}).catch(function(t){e.source.postMessage(JSON.stringify({event:"payment_request_apple_pay_get_prime_done",result:null,err:t}),init.origin)})}if(t.event==="payment_request_get_prime"){session.show().then(successCallback(e)).catch(failedCallback(e))}if(t.event==="setup_payment_request"){if(!window.PaymentRequest){e.source.postMessage(JSON.stringify({event:"payment_request_not_support_in_iframe"}),init.origin);return}saved_payment_request=t.paymentRequest;androidPayTapPayMerchantID=t.androidPayTapPayMerchantID;androidPayPublickKey=t.androidPayPublickKey;pay_with_google_options=t.pay_with_google_options;session=createPaymentRequest(saved_payment_request);var y=Promise.resolve(true);if(session.canMakePayment){y=session.canMakePayment()}y.then(function(t){e.source.postMessage(JSON.stringify({event:"setup_payment_request_done",result:{canMakePaymentWithActiveCard:t}}),init.origin)}).catch(function(t){console.log("[TapPay] PaymentRequest.canMakePayment error (see https://developers.google.com/web/fundamentals/payments/deep-dive-into-payment-request#check_payment_method_availability): ",t);e.source.postMessage(JSON.stringify({event:"setup_payment_request_done",result:{canMakePaymentWithActiveCard:true,error:t}}),init.origin)})}if(t.event==="google_pay_get_prime"){var _=t.payment_data;var v;var h=_.paymentMethodData.tokenizationData;if(typeof h.token==="string"){v=JSON.parse(h.token)}else if(typeof h.token==="object"){v=h.token}else{throw new Error("Type of `tokenData.token` is not string nor object")}var P=JSON.parse(v.signedMessage);v={protocolVersion:v.protocolVersion,signature:v.signature,ephemeralPublicKey:P.ephemeralPublicKey,encryptedMessage:P.encryptedMessage,tag:P.tag};googlePayGetPrime(v).then(function(t){var n=_.paymentMethodData.info.billingAddress||null;t.payer={email:_.email||null,name:n!==null?n.name:null,phone:n!==null?n.phoneNumber:null};t.billingAddress=n;t.shippingAddress=_.shippingAddress||null;var r=_.paymentMethodData.info;t.card={lastfour:r.cardDetails,type:transformCardType(r.cardNetwork)};e.source.postMessage(JSON.stringify({event:"google_pay_get_prime_done",result:t}),init.origin)})}}function successCallback(e){return function(t){var n=saved_payment_request;var r=n.details.shippingOptions;var i=n.details.total.amount.value;var a;if(n.options.requestShipping===true&&r&&r.length){var s=r.find(function(e){return e.id===t.shippingOption});var o=s.amount.value;a=(parseFloat(i)+parseFloat(o)).toString()}else{a=i}if(t.methodName==="basic-card"){var p=t.details.cardNumber;var u=t.details.expiryMonth;var c=t.details.expiryYear.slice(2);var d=t.details.cardSecurityCode;var l=false;createToken(p,u,c,d,l,function(n){if(n.status===0){n.payer={email:t.payerEmail,name:t.payerName,phone:t.payerPhone};n.billingAddress=t.details.billingAddress;n.shippingAddress=t.shippingAddress;n.shippingOption=t.shippingOption;n.methodName=METHOD_NAME.CARD;n.requestId=t.requestId;n.prime=n.card.prime;n.total_amount=a}e.source.postMessage(JSON.stringify({event:"payment_request_get_prime_done",result:n}),init.origin);t.complete("success")})}else if(t.methodName==="https://android.com/pay"){try{var f=JSON.parse(t.details.paymentMethodToken);if(!checkAndroidPayPaymentData(f)){throw new Error("Parsing android pay result happen error")}}catch(n){var g={status:402,msg:n.message};e.source.postMessage(JSON.stringify({event:"payment_request_get_prime_done",result:g}),init.origin);return t.complete("success")}androidPayGetPrime(f).then(function(n){if(n.status===0){n.payer={email:t.payerEmail,name:t.payerName,phone:t.payerPhone};n.billingAddress=t.details.billingAddress;n.shippingAddress=t.shippingAddress;n.shippingOption=t.shippingOption;n.methodName=METHOD_NAME.ANDROID_PAY;n.requestId=t.requestId;var r=t.details.instrumentInfos[0];n.card={lastfour:r.instrumentDetails,type:transformCardType(r.instrumentType)};n.android_pay={instrumentInfos:t.details.instrumentInfos,paymentDescriptions:t.details.paymentDescriptions,paymentMethodToken:t.details.paymentMethodToken};n.total_amount=a}e.source.postMessage(JSON.stringify({event:"payment_request_get_prime_done",result:n}),init.origin);t.complete("success")}).catch(function(n){e.source.postMessage(JSON.stringify({event:"payment_request_get_prime_done",result:n}),init.origin);t.complete("success")})}else if(t.methodName==="https://google.com/pay"){var f;try{if(typeof t.details.paymentMethodToken.token==="string"){f=JSON.parse(t.details.paymentMethodToken.token)}else if(typeof t.details.paymentMethodToken.token==="object"){f=t.details.paymentMethodToken.token}else{throw new Error("Type of `result.details.paymentMethodToken.token` is not string nor object")}var m=JSON.parse(f.signedMessage);f={protocolVersion:f.protocolVersion,signature:f.signature,ephemeralPublicKey:m.ephemeralPublicKey,encryptedMessage:m.encryptedMessage,tag:m.tag};if(!checkGooglePayPaymentData(f)){throw new Error("Parsing google pay result happen error")}}catch(n){var g={status:402,msg:"Failed to get GATEWAY_TOKEN with error: "+n.message};e.source.postMessage(JSON.stringify({event:"payment_request_get_prime_done",result:g}),init.origin);return t.complete("success")}googlePayGetPrime(f).then(function(n){if(n.status===0){n.payer={email:t.payerEmail,name:t.payerName,phone:t.payerPhone};n.billingAddress=t.details.billingAddress;n.shippingAddress=t.shippingAddress;n.shippingOption=t.shippingOption;n.methodName=METHOD_NAME.PAY_WITH_GOOGLE;n.requestId=t.requestId;var r=t.details.cardInfo;n.card={lastfour:r.cardDetails,type:transformCardType(r.cardNetwork),funding:transformCardFunding(r.cardClass)};n.total_amount=a}e.source.postMessage(JSON.stringify({event:"payment_request_get_prime_done",result:n}),init.origin);t.complete("success")}).catch(function(n){e.source.postMessage(JSON.stringify({event:"payment_request_get_prime_done",result:n}),init.origin);t.complete("success")})}}}function failedCallback(e){return function(t){var n={status:401,msg:t.message};e.source.postMessage(JSON.stringify({event:"payment_request_get_prime_done",result:n}),init.origin);session=createPaymentRequest(saved_payment_request)}}function createPaymentRequest(e){var t=e.supportedInstruments;var n=e.details;var r=e.options;if(r.shippingType==="servicePickup"){r.shippingType="pickup"}var i=new PaymentRequest(t,n,r);i.onshippingoptionchange=function(t){var n=JSON.parse(JSON.stringify(e.details));n.shippingOptions=n.shippingOptions.map(function(e){if(i.shippingOption===e.id){e.selected=true;n.total.amount.value=(parseFloat(n.total.amount.value)+parseFloat(e.amount.value)).toString()}else{e.selected=false}return e});t.updateWith(n)};i.onshippingaddresschange=function(t){t.updateWith(e.details)};return i}function transformCardType(e){var t=e.toUpperCase();return typeof CARD_TYPE[t]!=="undefined"?CARD_TYPE[t]:null}function transformCardFunding(e){var t=e.toUpperCase();return typeof CARD_FUNDING[t]!=="undefined"?CARD_FUNDING[t]:null}function getFraudId(){return Cookies.get("c1")||""}function checkAndroidPayPaymentData(e){if(!e){return false}if(!e.ephemeralPublicKey||typeof e.ephemeralPublicKey!=="string"){return false}if(!e.encryptedMessage||typeof e.encryptedMessage!=="string"){return false}if(!e.tag||typeof e.tag!=="string"){return false}return true}function checkGooglePayPaymentData(e){if(!e){return false}if(e.protocolVersion!=="ECv1"){return false}if(!e.signature||typeof e.signature!=="string"){return false}return checkAndroidPayPaymentData(e)}function createToken(e,t,n,r,i,a){if(!validate.cardNumber(e)){return a({card:{},clientip:"",msg:"Wrong Card Format",status:41})}if(!validate.expiry(t,n)){return a({card:{},clientip:"",msg:"Expired Card",status:2013})}r=r===""?null:r;if(r!=null&!validate.ccv(r)){return a({card:{},clientip:"",msg:"Wrong Card Format",status:41})}var s={cardnumber:e,cardduedate:"20"+n+t,appid:init.appID,appkey:init.appKey,appname:init.hostname,url:init.origin,port:init.port,protocol:init.protocol,fraudid:getFraudId()};if(r!=null){s.cardccv=r}var o="jsonString="+JSON.stringify(s);getPrimeRequest(o,i).then(function(e){if(e.status!=0){return a(e)}a({status:e.status,msg:e.msg,card:{prime:e.card.prime,issuer:e.cardinfo.issuer,lastfour:e.cardinfo.lastfour,bincode:e.cardinfo.bincode,funding:e.cardinfo.funding,type:e.cardinfo.type,level:e.cardinfo.level,country:e.cardinfo.country,countrycode:e.cardinfo.countrycode},clientip:e.clientip})})}function linePayGetPrime(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;var a=JSON.stringify({app_id:init.appID,app_key:init.appKey,app_name:init.hostname,platform_type:1,fraud_id:t});i.addEventListener("load",function(e){if(this.status>=200&&this.status<300){var t=JSON.parse(i.response);n(t)}else{r({status:-3,msg:"failed to get prime"})}},false);i.addEventListener("error",function(e){r({status:-3,msg:"failed to get prime"})},false);i.addEventListener("abort",function(e){r({status:-3,msg:"failed to get prime"})},false);i.open("POST",e,true);i.setRequestHeader("x-api-key",init.appKey);i.setRequestHeader("Content-type","application/json");i.send(a)})}function googlePayGetPrime(e){var t=tpAPI.getPayWithGooglePrime;var n={app_id:init.appID,app_key:init.appKey,app_name:init.hostname,pay_token_data:e,platform_type:2,fraud_id:getFraudId()};return new Promise(function(e,r){var i=new XMLHttpRequest;i.addEventListener("load",function(n){if(this.status>=200&&this.status<300){try{var a=JSON.parse(i.response)}catch(e){var s={status:-3,msg:"failed to get prime"};r(s);logger(s,t,LOGTYPE.API,true);return}if(a.status!==0){logger(JSON.parse(i.response),t,LOGTYPE.API,true)}e(a)}else{r({status:-3,msg:"failed to get prime"})}},false);i.addEventListener("error",function(e){r({status:-3,msg:"failed to get prime"})},false);i.addEventListener("abort",function(e){r({status:-3,msg:"failed to get prime"})},false);var a=JSON.stringify(n);i.open("POST",t,true);i.setRequestHeader("x-api-key",init.appKey);i.setRequestHeader("Content-Type","application/json");i.send(a)})}function androidPayGetPrime(e){var t={app_id:init.appID,app_key:init.appKey,app_name:init.hostname,pay_token_data:e,android_merchant_id:androidPayTapPayMerchantID,platform_type:2,fraud_id:getFraudId()};return new Promise(function(e,n){var r=new XMLHttpRequest;r.addEventListener("load",function(t){if(this.status>=200&&this.status<300){var i=JSON.parse(r.response);if(i.status!==0){logger(JSON.parse(r.response),tpAPI.getAndroidPayPrime,LOGTYPE.API,true)}e(i)}else{n({status:-3,msg:"failed to get prime"})}},false);r.addEventListener("error",function(e){n({status:-3,msg:"failed to get prime"})},false);r.addEventListener("abort",function(e){n({status:-3,msg:"failed to get prime"})},false);var i=JSON.stringify(t);r.open("POST",tpAPI.getAndroidPayPrime,true);r.setRequestHeader("x-api-key",init.appKey);r.setRequestHeader("Content-Type","application/json");r.send(i)})}function getApplePayPrime(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.addEventListener("load",function(e){if(this.status>=200&&this.status<300){var i=JSON.parse(r.response);if(i.status!==0){logger(JSON.parse(r.response),tpAPI.getApplePayPrime,LOGTYPE.API)}t(i)}else{n({status:-3,msg:"failed to get prime"})}},false);r.addEventListener("error",function(e){n({status:-3,msg:"failed to get prime"})},false);r.addEventListener("abort",function(e){n({status:-3,msg:"failed to get prime"})},false);var i=JSON.stringify(e);r.open("POST",tpAPI.getApplePayPrime,true);r.setRequestHeader("x-api-key",init.appKey);r.setRequestHeader("Content-Type","application/json");r.send(i)})}function getApplePaySession(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.addEventListener("load",function(e){if(this.status>=200&&this.status<300){var i=JSON.parse(r.response);if(i.status!==0){logger(JSON.parse(r.response),tpAPI.getApplePaySession,LOGTYPE.API)}t(i)}else{n({status:this.status,statusText:r.statusText})}},false);r.addEventListener("error",function(e){n({status:this.status,statusText:r.statusText})},false);r.addEventListener("abort",function(e){n({status:this.status,statusText:r.statusText})},false);r.open("POST",tpAPI.getApplePaySession,true);r.setRequestHeader("x-api-key",init.appKey);r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");r.send(e)})}function getPrimeRequest(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;i.addEventListener("load",function(e){if(this.status>=200&&this.status<300){var r=JSON.parse(i.response);if(r.status!==0){logger(JSON.parse(i.response),tpAPI.getPrime,LOGTYPE.API,t)}n(r)}else{n({card:{},clientip:"",msg:"failed to get prime",status:-3})}},false);i.addEventListener("error",function(e){n({card:{},clientip:"",msg:"failed to get prime",status:-3})},false);i.addEventListener("abort",function(e){n({card:{},clientip:"",msg:"failed to get prime",status:-3})},false);i.open("POST",tpAPI.getPrime,true);i.setRequestHeader("x-api-key",init.appKey);i.setRequestHeader("Content-type","application/x-www-form-urlencoded");i.send(e)})}var logger=function(e,t,n,r){var i=new XMLHttpRequest;var a={c1:getFraudId(),name:t,type:n,app_id:init.appID||"",app_key:init.appKey||"",server_type:init.serverType||"",sdk_version:init.sdk_version||"test",get_prime_type:r===true?"with form":r===false?"without form":"",platform_type:"web",response:e,user_info:{hostname:init.hostname,origin:init.origin,referrer:init.referrer,href:init.href,android_merchant_id:androidPayTapPayMerchantID||"",android_pub_key:androidPayPublickKey||""}};var s=JSON.stringify(a);i.open("POST",tpAPI.log,true);i.setRequestHeader("Content-type","application/json");i.send(s)};