(function(e){var t=false;if(typeof define==="function"&&define.amd){define(e);t=true}if(typeof exports==="object"){module.exports=e();t=true}if(!t){var r=window.Cookies;var n=window.Cookies=e();n.noConflict=function(){window.Cookies=r;return n}}})(function(){function e(){var e=0;var t={};for(;e<arguments.length;e++){var r=arguments[e];for(var n in r){t[n]=r[n]}}return t}function t(r){function n(t,i,o){var s;if(typeof document==="undefined"){return}if(arguments.length>1){o=e({path:"/"},n.defaults,o);if(typeof o.expires==="number"){var a=new Date;a.setMilliseconds(a.getMilliseconds()+o.expires*864e5);o.expires=a}o.expires=o.expires?o.expires.toUTCString():"";try{s=JSON.stringify(i);if(/^[\{\[]/.test(s)){i=s}}catch(e){}if(!r.write){i=encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)}else{i=r.write(i,t)}t=encodeURIComponent(String(t));t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);t=t.replace(/[\(\)]/g,escape);var f="";for(var d in o){if(!o[d]){continue}f+="; "+d;if(o[d]===true){continue}f+="="+o[d]}return document.cookie=t+"="+i+f}if(!t){s={}}var u=document.cookie?document.cookie.split("; "):[];var c=/(%[0-9A-Z]{2})+/g;var l=0;for(;l<u.length;l++){var p=u[l].split("=");var w=p.slice(1).join("=");if(w.charAt(0)==='"'){w=w.slice(1,-1)}try{var g=p[0].replace(c,decodeURIComponent);w=r.read?r.read(w,g):r(w,g)||w.replace(c,decodeURIComponent);if(this.json){try{w=JSON.parse(w)}catch(e){}}if(t===g){s=w;break}if(!t){s[g]=w}}catch(e){}}return s}n.set=n;n.get=function(e){return n.call(n,e)};n.getJSON=function(){return n.apply({json:true},[].slice.call(arguments))};n.defaults={};n.remove=function(t,r){n(t,"",e(r,{expires:-1}))};n.withConverter=t;return n}return t(function(){})});var init=JSON.parse(decodeURIComponent(window.location.search.substring(1)));var browser_mode="detecting";detectBrowserMode(function(e){browser_mode=e;getExistingFraud();getFraud()});function storeCookies(e){Cookies.set("c1",e,{expires:730,domain:"tappaysdk.com"})}function postFraudId(e){window.parent.postMessage(JSON.stringify({event:"fraud_id",result:e}),init.origin)}function logger(e){var t="[TapPay Fraud]: Unable to get fraud_id.";if(e){t=t+" ("+e+")"}console.warn(t)}function getExistingFraud(){var e=Cookies.get("c1");if(e){postFraudId(e)}}function getFraud(){var e={c1:Cookies.get("c1"),user_info:{user_platform:"web",hostname:init.hostname,origin:init.origin,server_type:init.serverType,referrer:init.referrer,href:init.href,browser_mode:browser_mode}};var t=new XMLHttpRequest;t.addEventListener("load",function(e){if(this.status>=200&&this.status<300){var r=JSON.parse(t.response);if(r.status===0){storeCookies(r.c1);postFraudId(r.c1)}else{logger(r.msg)}}else{logger(this.status)}},false);t.addEventListener("error",function(e){logger(this.status)},false);t.addEventListener("abort",function(e){logger(this.status)},false);t.open("POST","/get_fraud_id",true);t.setRequestHeader("x-api-key",init.appKey);t.setRequestHeader("Content-Type","application/json");t.send(JSON.stringify(e))}function isIE10OrLater(e){var t=e.toLowerCase();if(t.indexOf("msie")===0&&t.indexOf("trident")===0){return false}var r=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);if(r&&parseInt(r[1],10)>=10){return true}return false}function detectBrowserModeRetry(e,t){var r=0,n=50,i=10,o=false;var s=window.setInterval(function(){if(e()){window.clearInterval(s);t(o)}if(r++>n){window.clearInterval(s);o=true;t(o)}},i)}function detectBrowserMode(e){var t;var r=true;var n=window.RequestFileSystem||window.webkitRequestFileSystem;if(n){r=false;n(window.TEMPORARY,1,function(){t=false},function(e){t=true})}else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var i;try{i=window.indexedDB.open("BkCNl2mKf")}catch(e){t=true}if(typeof t==="undefined"){detectBrowserModeRetry(function e(){return i.readyState==="done"?true:false},function e(r){if(!r){t=i.result?false:true}})}}else if(isIE10OrLater(window.navigator.userAgent)){t=false;try{if(!window.indexedDB){t=true}}catch(e){t=true}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("BkCNl2mKf",1)}catch(e){t=true}if(typeof t==="undefined"){t=false;window.localStorage.removeItem("BkCNl2mKf")}}detectBrowserModeRetry(function e(){return typeof t!=="undefined"?true:false},function r(n){if(typeof t==="undefined"){return e("unknown")}e(t?"private":"normal")})}